$(document).ready(function () {
    //Check LocalStorage
    if (localStorage.getItem("li_url") != undefined && localStorage.getItem("li_url").length > 0) {
        var li_url = ""
        $('.nav-link').each(function() {
            if ($(this).attr('href') == localStorage.getItem("li_url")) {
                $("#"+databtn).addClass('active')
            }
        })
    }else{
        $(this).addClass('active');
    }
    // On Click
    $('.nav-link').click(function(e) {
        $(this).removeClass('active');
        $(this).removeClass('active');
        var li_id = $(this).attr('href')
        localStorage.setItem("li_id", li_id);
    });
});

$(function () {
  $(".table-datatable-filter").DataTable({
    "responsive": true, "lengthChange": false, "autoWidth": false,
    "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
  }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
  $('.table-datatable').DataTable({
    "paging": true,
    "lengthChange": false,
    "searching": false,
    "ordering": true,
    "info": true,
    "autoWidth": false,
    "responsive": true,
  });
});

var format = function(num){
    var str = num.toString().replace("Rp ", ""), parts = false, output = [], i = 1, formatted = null;
    if(str.indexOf(",") > 0) {
      parts = str.split(",");
      str = parts[0];
    }
    str = str.split("").reverse();
    for(var j = 0, len = str.length; j < len; j++) {
      if(str[j] != ".") {
        output.push(str[j]);
        if(i%3 == 0 && j < (len - 1)) {
          output.push(".");
        }
        i++;
      }
    }
    formatted = output.reverse().join("");
    return("" + formatted + ((parts) ? "," + parts[1].substr(0, 2) : ""));
  };

$(".cekHarga").keyup(function(e){
    $(this).val($(this).val().replace(/[^0-9\.]/g,''));
    if ((e.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
        event.preventDefault();
        var isi = $(this).val()
        if (isi.length > 1 && isi.substring(0,1) == 0) {
          $(this).val(format($(this).val()).slice(1));
        }else{
          $(this).val(format($(this).val()));
        }
        // $(this).val(format($(this).val()));
    }
});

$('#submitBudgeting').on('click',function(){
    var urlpage = $("#fk_purpose").val() == 1 ? 'campaign' : 'ads'
    swal({
        title: "Save budget request?",
        text: " Click 'Save Request' to submit your budget request",
        type: "info",
        confirmButtonColor: "#1b74ff",
        cancelButtonColor: "#f00",
        confirmButtonText: "Save Request",
        cancelButtonText: "Batal",
        showCancelButton: true,
        closeOnConfirm: false,
        showLoaderOnConfirm: true
      }, function () {
        $.ajax({
            'url': '/marketing/budgeting/submit-request',
            'type': 'POST',
            'data': {
               'req_headline' :     $("#req_headline").val(),
               'fk_brand' :         $("#fk_brand").val(),
               'fk_purpose' :       $("#fk_purpose").val(),
               'req_budget' :       $("#req_budget").val(),
               'req_description' :  $("#req_description").val(),
            },
            'success': function (result) {
              if(result.code == 200){
                swal(result.title, result.message, "success");
                setTimeout(function () {
                  window.location.href = '/marketing/budgeting/'+urlpage
                }, 2000)
              }
            },
            error: function(xhr, status, error) {
                console.log(error)
            }
       });
    });
  })